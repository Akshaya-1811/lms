# k8s manifest files #
pipeline {
    agent {
    node {
        label 'slave'
         }
    }
    stages {
        stage('DB deployment') {
            steps {
                sh 'cd k8s && kubectl apply -f db-deployment.yml'
            }
        }
        stage('DB cluster-ip-service') {
            steps {
                sh 'cd k8s && kubectl apply -f db-cluster-ip-service.yml'
            }
        }
        stage('DB persistent-volume') {
            steps {
                sh 'cd k8s && kubectl apply -f database-persistent-volume-claim.yml'
            }
        }
        stage('backend deployment') {
            steps {
                sh 'cd k8s && kubectl apply -f api-deployment.yml'
            }
        }
        stage('backend lb-service') {
            steps {
                sh 'cd k8s && kubectl apply -f api-lb-service.yml'
            }
        }        
        stage('frontend deployment') {
            steps {
                sh 'cd k8s && kubectl apply -f web-deployment.yml'
            }
        }
        stage('frontend lb-service') {
            steps {
                sh 'cd k8s && kubectl apply -f web-lb-service.yml'
            }
        }         
    }
}
